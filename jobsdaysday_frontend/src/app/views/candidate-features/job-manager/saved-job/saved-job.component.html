<div class="container py-4" style="max-width: 1200px;">
  <div class="card mb-3 shadow-sm">

    <div class="card-header bg-primary p-4">
      <h2 class="fw-bold text-white mb-2">Việc làm đã lưu</h2>
      <div class="text-white mb-0" style="font-size: 1.1rem;">
        Xem lại danh sách những việc làm bạn đã lưu trước đó. Ứng tuyển ngay để không bỏ lỡ cơ hội nghề nghiệp dành cho
        bạn.
      </div>
    </div>

    <div class="card-body">
      <div class="mb-3 fw-bold text-primary" style="font-size: 1.1rem;">
        Danh sách <span class="text-danger">{{ totalElements }}</span> việc làm đã lưu
      </div>

      <div *ngFor="let job of savedJobs; let i = index" class="card job-card mb-3" style="position: relative;"
        (mouseenter)="hoveredJobIndex = i" (mouseleave)="hoveredJobIndex = null" (click)="openJobDetail(job.id)">
        <div class="card-body d-flex gap-4">
          <img [src]="job.companyLogo || 'assets/logo1.png'" alt="Logo" width="120" height="120"
                class="rounded bg-white border" (error)="onLogoError($event)"/>
          <div class="flex-grow-1">
            <h3 class="h6 fw-bold text-primary mb-1">
              {{ job.title }}
            </h3>
            <div class="d-flex gap-4 mb-2">
              <div class="text-primary">{{ job.salary }}</div>
              <div class="text-muted">{{ job.level }}</div>
            </div>
            <div class="d-flex flex-wrap gap-2 text-secondary mb-2">
              <span>{{ job.location }}</span>
              <span *ngIf="job.jobType">({{ job.jobType }})</span>
            </div>
            <div class="text-muted small">Đã lưu: {{ job.savedAt | date:'dd/MM/yyyy - HH:mm' }}</div>
            <hr class="w-100 my-2">
            <div class="d-flex justify-content-between align-items-center" style="height: 34px; position: relative;">
              <div>
                <span class="badge bg-primary me-1" *ngFor="let skill of job.skills.slice(0, 3)">{{ skill
                  }}</span>
                <span *ngIf="job.skills.length > 3" class="badge bg-primary me-1"
                  [title]="job.skills.slice(3).join(', ')" style="cursor: pointer;">
                  +{{ job.skills.length - 3 }}
                </span>
              </div>
              <!-- Đặt cả hai trường hợp vào cùng một vị trí tuyệt đối -->
              <div *ngIf="job.applied || (!job.applied && hoveredJobIndex === i)"
                style="position: absolute; right: 0; bottom: -5px; display: flex; align-items: center;">
                <span class="text-muted small" style="margin-right: 8px;">
                  {{ getPostedLabel(job.postedAt) }}
                </span>
                <button *ngIf="job.applied" class="btn"
                  style="background: #6c757d; color: #fff; font-weight: bold; border-radius: 20px; min-width: 90px;"
                  disabled>
                  Đã ứng tuyển <i class="bi bi-check-lg"></i>
                </button>
                <button *ngIf="!job.applied && hoveredJobIndex === i" class="btn"
                  style="background: #007bff; color: #fff; font-weight: bold; border-radius: 20px; min-width: 90px;"
                  (click)="openJobDetail(job.id); $event.stopPropagation()">
                  Ứng tuyển
                </button>
              </div>
              <!-- Nếu chưa ứng tuyển và không hover: ngày đăng ở góc phải -->
              <span *ngIf="!job.applied && hoveredJobIndex !== i" class="text-muted small"
                style="position: absolute; right: 0; bottom: 0;">
                {{ getPostedLabel(job.postedAt) }}
              </span>
            </div>
          </div>
          <button class="btn btn-outline-primary" aria-label="Bỏ lưu"
            style="position: absolute; top: 16px; right: 16px; z-index: 2;"
            (click)="onUnsaveClick(job); $event.stopPropagation()">
            <i class="bi bi-heart-fill"></i>
          </button>
        </div>
      </div>

      <div *ngIf="savedJobs.length === 0" class="text-center text-muted fw-bold py-5">
        Bạn chưa lưu công việc nào. Hãy tìm kiếm và lưu các công việc phù hợp để dễ dàng truy cập và ứng tuyển sau này!
      </div>

      <!-- Phân trang -->
      <div *ngIf="totalPages > 1" class="d-flex justify-content-center align-items-center gap-2 my-4">
        <button class="btn btn-outline-primary rounded-circle px-2" [disabled]="currentPage === 0"
          (click)="changePage(currentPage - 1)" style="width: 36px; height: 36px;">
          <i class="bi bi-chevron-left"></i>
        </button>
        <span class="fw-bold text-primary" style="font-size: 1.1rem;">
          {{ currentPage + 1 }} <span class="text-muted">/ {{ totalPages }} trang</span>
        </span>
        <button class="btn btn-outline-primary rounded-circle px-2" [disabled]="currentPage + 1 >= totalPages"
          (click)="changePage(currentPage + 1)" style="width: 36px; height: 36px;">
          <i class="bi bi-chevron-right"></i>
        </button>
      </div>
    </div>
  </div>
</div>

<app-error-dialog
  *ngIf="showErrorDialog"
  [title]="errorTitle"
  [message]="errorMessage"
  (cancel)="handleCancel()">
</app-error-dialog>
