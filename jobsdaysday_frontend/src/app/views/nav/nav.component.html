<nav class="navbar">
  <div class="navbar-logo">
    <a routerLink="/">
      <img src="assets/baner.png" alt="Logo">
    </a>
  </div>

  <ul class="navbar-menu">
    <li *ngIf="isLogging == false || user?.role == 'CANDIDATE'"
        class="navbar-item dropdown"
        routerLinkActive="active" [routerLinkActiveOptions]="{ exact: false }">
      <a routerLink="/jobsday">Việc làm <i *ngIf="isLogging == true || user?.role == 'CANDIDATE'" class="bi bi-chevron-down"></i></a>
      <ul class="dropdown-menu" style="width: max-content;" *ngIf="isLogging == true || user?.role == 'CANDIDATE'">
        <li><a routerLink="/jobsday" routerLinkActive="active" [routerLinkActiveOptions]="{ exact: true }">Tìm việc làm</a></li>
        <li><a routerLink="/saved-jobs" routerLinkActive="active" [routerLinkActiveOptions]="{ exact: true }">Việc làm đã lưu</a></li>
        <li><a routerLink="/applied-history" routerLinkActive="active" [routerLinkActiveOptions]="{ exact: true }">Việc làm đã ứng tuyển</a></li>
      </ul>
    </li>

    <li *ngIf="user?.role == 'CANDIDATE'" class="navbar-item dropdown"
        routerLinkActive="active" [routerLinkActiveOptions]="{ exact: false }">
      <a routerLink="/quan-ly-cv">Quản lý CV <i class="bi bi-chevron-down"></i></a>
      <ul class="dropdown-menu" style="width: max-content;">
        <li><a routerLink="/quan-ly-cv" routerLinkActive="active" [routerLinkActiveOptions]="{ exact: true }">CV của tôi</a></li>
        <li><a routerLink="/upload-cv" routerLinkActive="active" [routerLinkActiveOptions]="{ exact: true }">Tải CV lên</a></li>
        <li><a routerLink="/xem-ho-so" routerLinkActive="active" [routerLinkActiveOptions]="{ exact: true }">Nhà tuyển dụng xem hồ sơ</a></li>
      </ul>
    </li>

    <li *ngIf="user?.role == 'HR'" class="navbar-item" routerLinkActive="active" [routerLinkActiveOptions]="{ exact: true }">
      <a routerLink="/analytics-hr">Thống kê</a>
    </li>

    <li *ngIf="user?.role == 'HR'" class="navbar-item dropdown"
        routerLinkActive="active" [routerLinkActiveOptions]="{ exact: false }">
      <a routerLink="/quan-ly-job">Quản lý Job<i class="bi bi-chevron-down"></i></a>
      <ul class="dropdown-menu">
        <li><a routerLink="/quan-ly-job" routerLinkActive="active" [routerLinkActiveOptions]="{ exact: true }">Danh sách Job</a></li>
        <li><a routerLink="/create-job" routerLinkActive="active" [routerLinkActiveOptions]="{ exact: true }">Đăng tin mới</a></li>
      </ul>
    </li>

    <li *ngIf="user?.role == 'HR'" class="navbar-item" routerLinkActive="active" [routerLinkActiveOptions]="{ exact: true }">
      <a routerLink="/search-candidates">Tìm kiếm ứng viên</a>
    </li>

    <li *ngIf="user?.role == 'HR' && member?.isAdmin == true" class="navbar-item dropdown"
        routerLinkActive="active" [routerLinkActiveOptions]="{ exact: false }">
      <a routerLink="/company-manager">Quản lý Công ty <i class="bi bi-chevron-down"></i></a>
      <ul class="dropdown-menu" style="width: max-content;">
        <li><a routerLink="/company-manager" routerLinkActive="active" [routerLinkActiveOptions]="{ exact: true }">Quản lý thành viên</a></li>
        <li><a routerLink="/approve-member" routerLinkActive="active" [routerLinkActiveOptions]="{ exact: true }">Duyệt thành viên</a></li>
        <li><a routerLink="/company-info" routerLinkActive="active" [routerLinkActiveOptions]="{ exact: true }">Thông tin công ty</a></li>
      </ul>
    </li>

    <li *ngIf="user?.role == 'ADMIN'" class="navbar-item" routerLinkActive="active" [routerLinkActiveOptions]="{ exact: true }">
      <a routerLink="/analytics">Thống kê</a>
    </li>

    <li *ngIf="user?.role == 'ADMIN'" class="navbar-item" routerLinkActive="active" [routerLinkActiveOptions]="{ exact: true }">
      <a routerLink="/user-manager">Quản lý tài khoản</a>
    </li>

    <li *ngIf="user?.role == 'ADMIN'" class="navbar-item" routerLinkActive="active" [routerLinkActiveOptions]="{ exact: true }">
      <a routerLink="/company-management">Quản lý Công ty</a>
    </li>
  </ul>

  <ul class="navbar-right">
    <ng-container *ngIf="isLogging; else loggedOut">
      <li class="icon-item dropdown" *ngIf="user?.role != 'ADMIN'">
        <button class="icon-content position-relative" (click)="toggleNotificationDropdown()">
          <div class="icon-container">
            <i class="bi bi-bell"></i>
            <span *ngIf="notifications.length > 0" class="notify-badge">{{ notifications.length }}</span>
          </div>
        </button>
        <div class="dropdown-menu" [class.show]="showNotificationDropdown" *ngIf="showNotificationDropdown"
          style="width: 400px;">
          <div class="d-flex align-items-center justify-content-between fw-bold px-3 py-2 border-bottom bg-light"
            style="position: sticky; top: 0; z-index: 1; background: #f8f9fa;">
            <span>Thông báo</span>
            <button class="btn btn-link p-0 fw-normal" (click)="markAllAsRead()" style="font-size: 0.95rem;">
              Đánh dấu đã đọc
            </button>
          </div>
          <div style="max-height: 45vh; overflow-y: auto;">
            <ng-container *ngIf="notifications.length > 0; else noNotify">
              <div *ngFor="let notify of notifications" class="px-3 py-2 border-bottom" style="cursor: pointer;"
                (click)="goToLink(notify)">
                <div style="font-size: small; font-weight: 600;">{{ notify.title }}</div>
                <div>{{ notify.message }}</div>
                <div class="text-muted small">{{ notify.createdAt | date:'dd/MM/yyyy HH:mm' }}</div>
              </div>
            </ng-container>
            <ng-template #noNotify>
              <div class="px-3 py-4 text-center text-muted">Không có thông báo mới nào</div>
            </ng-template>
          </div>
        </div>
      </li>
      <li class="icon-item" *ngIf="user?.role != 'ADMIN'">
        <button class="icon-content position-relative" (click)="openChatModal()">
          <div class="icon-container">
            <i class="bi bi-chat-dots"></i>
            <span *ngIf="unreadConversationsCount > 0" class="notify-badge">
              {{ unreadConversationsCount > 99 ? '+99' : unreadConversationsCount }}
            </span>
          </div>
        </button>
      </li>
      <li class="icon-item dropdown">
        <a routerLink="/profile" class="user-link">
          <img [src]="user?.avatarUrl || 'assets/user.jpg'" alt="Avatar" class="avatar">
          <div class="small-icon">
            <i class="bi bi-chevron-down"></i>
          </div>
        </a>
        <ul class="dropdown-menu p-0" style="min-width: 260px;">
          <li class="px-3 py-3 border-bottom">
            <div class="d-flex align-items-center gap-3">
              <img [src]="user?.avatarUrl || 'assets/user.jpg'" alt="Avatar" width="48" height="48"
                class="rounded-circle border" />
              <div>
                <div class="fw-bold">{{ user?.fullName }}</div>
                <div class="text-muted small">
                  ID {{ user?.id }} | {{ user?.email }}
                </div>
              </div>
            </div>
          </li>
          <li class="py-1"></li>
          <li><a routerLink="/personal-info" class="fw-bold" *ngIf="user?.role != 'ADMIN'">Thông tin cá nhân</a></li>
          <li><a routerLink="/change-password" class="fw-bold" *ngIf="user?.role != 'ADMIN'">Đổi mật khẩu</a></li>
          <li class="px-3 py-3">
            <button (click)="logout()"
              class="btn btn-light w-100 py-2 fw-bold d-flex align-items-center justify-content-center gap-2 rounded-pill">
              <i class="bi bi-box-arrow-right"></i> Đăng xuất
            </button>
          </li>
        </ul>
      </li>
    </ng-container>

    <ng-template #loggedOut>
      <li>
        <a class="btn btn-outline" routerLink="/register">Đăng ký</a>
      </li>
      <li>
        <a class="btn btn-primary" routerLink="/login">Đăng nhập</a>
      </li>
    </ng-template>
  </ul>
</nav>
