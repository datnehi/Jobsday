<div class="container py-4 cv-manager-wrapper">
  <div class="row cv-manager-row">
    <div class="col-lg-8 mb-4 cv-manager-main">
      <div class="card shadow-sm mb-3 cv-manager-main-card">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center mb-4 cv-manager-header">
            <h2 class="fw-bold text-primary mb-0 cv-manager-title">CV đã tải lên Jobsday</h2>
            <button class="btn btn-primary fw-bold px-4 py-2 cv-upload-btn" routerLink="/upload-cv">+ Tải CV lên</button>
          </div>
          <div class="row cv-grid">
            <div class="col-md-6 mb-4 cv-grid-item" *ngFor="let cv of uploadedCVs; let i = index">
              <div class="card shadow-sm rounded h-100 text-center p-3 position-relative cv-card"
                   (mouseenter)="hoveredIndex = i" (mouseleave)="hoveredIndex = null" (click)="viewCv(cv.id, 'view')">
                <img src="assets/cv.png" alt="CV Folder" class="mx-auto mb-3 cv-icon" />
                <div class="fw-bold mb-1 cv-title-text">{{ cv.title }}</div>
                <div class="text-muted small mb-2 cv-updated-text">Cập nhật {{ cv.updatedAt | date:'dd-MM-yyyy HH:mm' }}</div>
                <div class="d-flex justify-content-center gap-2 mb-2 cv-action-row">
                  <button class="btn btn-primary btn-sm px-3 cv-download-btn" (click)="viewCv(cv.id, 'download'); $event.stopPropagation()">Tải về</button>
                  <div class="dropdown cv-more-dropdown" (mouseenter)="showDropdown[i]=true" (mouseleave)="showDropdown[i]=false" [class.show]="showDropdown[i]">
                    <button class="btn btn-outline-secondary btn-sm px-3 cv-more-btn" type="button"
                      [attr.aria-expanded]="showDropdown[i]" (click)="showDropdown[i]=!showDropdown[i]; $event.stopPropagation()">
                      ...
                    </button>
                    <ul class="dropdown-menu dropdown-menu-end cv-dropdown-menu" [class.show]="showDropdown[i]">
                      <li>
                        <a class="dropdown-item" (click)="changeTitle(cv.id, cv.title); $event.stopPropagation()">Đổi tên CV</a>
                      </li>
                      <li>
                        <a class="dropdown-item text-danger" (click)="deleteCv(cv.id); $event.stopPropagation()">Xóa CV</a>
                      </li>
                    </ul>
                  </div>
                </div>
                <span *ngIf="cv.isPublic" class="position-absolute top-0 m-2 text-warning fs-3 cv-tooltip-parent cv-public-mark">
                  <i class="bi bi-star-fill"></i>
                  <span class="cv-tooltip">
                    CV chính, CV này sẽ được hiển thị cho Nhà tuyển dụng khi tìm kiếm ứng viên
                  </span>
                </span>
                <span *ngIf="!cv.isPublic && hoveredIndex === i" class="position-absolute top-0 m-2 text-muted fs-3 cv-tooltip-parent cv-set-main-mark" (click)="setAsMain(cv.id); $event.stopPropagation()">
                  <i class="bi bi-star"></i>
                  <span class="cv-tooltip">
                    Đặt làm CV chính, CV này sẽ được hiển thị cho Nhà tuyển dụng khi tìm kiếm ứng viên
                  </span>
                </span>
              </div>
            </div>
            <div *ngIf="uploadedCVs.length === 0" class="text-center text-muted fw-bold py-5 cv-empty-text">
              Bạn chưa tải lên CV nào. Hãy tải lên để bắt đầu ứng tuyển các công việc phù hợp!
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="col-lg-4 mb-4 cv-manager-side">
      <div class="card shadow-sm mb-3 cv-side-card">
        <div class="card-body">
          <div class="mb-3 d-flex align-items-center gap-3">
            <img [src]="user.avatarUrl || 'assets/user.jpg'" alt=" Avatar" class="rounded-circle border cv-side-avatar" />
            <h4 class="fw-bold text-primary mb-1 mb-0 cv-side-welcome">Chào bạn trở lại, <b>{{ user.fullName }}</b></h4>
          </div>
          <div>
            <div class="form-check form-switch d-flex align-items-center mb-2">
              <input class="form-check-input me-2 cv-ntd-checkbox" type="checkbox" [(ngModel)]="allowNTDSearch" id="ntdSearch" (change)="toggleSearchChange()" />
              <label class="form-check-label fw-bold text-primary" for="ntdSearch">
                Cho phép NTD tìm kiếm hồ sơ
              </label>
            </div>
            <ul class="mt-2 text-muted ps-3">
              <li>Nhắn tin qua Jobsday</li>
              <li>Email và Số điện thoại của bạn</li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div *ngIf="showRenameDialog" class="modal-backdrop fade show cv-rename-backdrop"></div>
<div class="modal fade cv-rename-modal" tabindex="-1" [class.show]="showRenameDialog" [style.display]="showRenameDialog ? 'block' : 'none'">
  <div class="modal-dialog">
    <div class="modal-content cv-rename-content">
      <div class="modal-header cv-rename-header">
        <h5 class="modal-title fw-bold cv-rename-title">Chỉnh sửa CV Upload</h5>
        <button type="button" class="btn-close" (click)="closeRenameDialog()"></button>
      </div>
      <div class="modal-body cv-rename-body">
        <label class="fw-bold mb-2 cv-rename-label">Tên CV <span class="text-muted cv-rename-hint">(thường là vị trí ứng tuyển)</span></label>
        <input type="text" class="form-control cv-rename-input" [(ngModel)]="renameTitle" />
      </div>
      <div class="modal-footer cv-rename-footer">
        <button type="button" class="btn btn-outline-secondary cv-rename-cancel" (click)="closeRenameDialog()">Hủy</button>
        <button type="button" class="btn btn-primary cv-rename-confirm" (click)="confirmRename()">Cập nhật</button>
      </div>
    </div>
  </div>
</div>

<app-error-dialog
  *ngIf="showErrorDialog"
  [title]="errorTitle"
  [message]="errorMessage"
  (cancel)="handleCancel()">
</app-error-dialog>

<app-loading *ngIf="isLoading"></app-loading>

