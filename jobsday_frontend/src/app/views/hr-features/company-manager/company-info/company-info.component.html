<div class="container py-4 company-info-wrapper">
  <div class="row company-info-row">
    <div class="col-lg-8 mb-4 company-info-main">
      <div class="card shadow-sm mb-4 company-form-card">
        <div class="card-body company-form-body">
          <h4 class="fw-bold mb-3 company-form-title">Cài đặt thông tin công ty</h4>
          <div class="mb-2 text-danger small company-form-required">
            <span class="fw-bold">*</span> Các thông tin bắt buộc
          </div>
          <form [formGroup]="companyForm" (ngSubmit)="openConfirm()" class="company-form" novalidate>
            <div class="mb-3">
              <label class="form-label fw-bold company-label">Tên công ty <span class="text-danger">*</span></label>
              <input type="text" class="form-control company-input" formControlName="name" required>
              <div *ngIf="companyForm.get('name')?.invalid && companyForm.get('name')?.touched" class="text-danger">
                Tên công ty không được để trống
              </div>
            </div>
            <div class="mb-3">
              <label for="companyLocation" class="form-label company-label">Khu vực <span class="text-danger">*</span></label>
              <select id="companyLocation" class="form-select company-select" formControlName="location" required>
                <option value="">-- Chọn khu vực --</option>
                <option value="Hà Nội">Hà Nội</option>
                <option value="Đà Nẵng">Đà Nẵng</option>
                <option value="Hồ Chí Minh">Hồ Chí Minh</option>
              </select>
              <div *ngIf="companyForm.get('location')?.invalid && companyForm.get('location')?.touched"
                class="text-danger">
                Khu vực không được để trống
              </div>
            </div>
            <div class="mb-3">
              <label class="form-label fw-bold company-label">Địa chỉ <span class="text-danger">*</span></label>
              <input type="text" class="form-control company-input" formControlName="address" required>
              <div *ngIf="companyForm.get('address')?.invalid && companyForm.get('address')?.touched"
                class="text-danger">
                Địa chỉ không được để trống
              </div>
            </div>
            <div class="mb-3">
              <label class="form-label fw-bold company-label">Website</label>
              <input type="text" class="form-control company-input" formControlName="website">
            </div>
            <div class="mb-3">
              <label class="form-label fw-bold company-label">Mã số thuế <span class="text-danger">*</span></label>
              <input type="text" class="form-control company-input" formControlName="taxCode" required>
              <div *ngIf="companyForm.get('taxCode')?.invalid && companyForm.get('taxCode')?.touched"
                class="text-danger">
                Mã số thuế không được để trống
              </div>
            </div>
            <div class="mb-3">
              <label class="form-label fw-bold company-label">Email <span class="text-danger">*</span></label>
              <input type="email" class="form-control company-input" formControlName="email">
              <div *ngIf="companyForm.get('email')?.invalid && companyForm.get('email')?.touched" class="text-danger">
                Email không hợp lệ
              </div>
            </div>
            <div class="mb-3">
              <label class="form-label fw-bold company-label">Kỹ năng của công ty</label>
              <ng-select [items]="skillsList" bindLabel="name" bindValue="id" [multiple]="true" [searchable]="true"
                formControlName="skills" class="form-control company-skills-select" [closeOnSelect]="false">

                <ng-template ng-option-tmp let-item="item">
                  <div class="skill-option">
                    <input type="checkbox"
                      [checked]="selectedSkills.includes(item.id)"
                      (click)="$event.stopPropagation()"
                      (change)="onSkillChange(item.id, $any($event.target).checked)"
                      style="margin-right:8px;">
                    {{ item.name }}
                  </div>
                </ng-template>
              </ng-select>
            </div>
            <div class="mb-3">
              <label class="form-label fw-bold company-label">Mô tả</label>
              <textarea class="form-control company-textarea" formControlName="description" rows="4"></textarea>
            </div>
            <div class="company-form-actions">
              <button type="submit" class="btn btn-primary px-4 fw-bold company-submit-btn" [disabled]="companyForm.invalid">Lưu</button>
            </div>
          </form>
        </div>
      </div>
    </div>
    <div class="col-lg-4 mb-4 company-info-side">
      <div class="card shadow-sm mb-3 company-side-card">
        <div class="card-body company-side-body">
          <div class="mb-3 d-flex gap-2 flex-row company-logo-row">
            <div class="position-relative d-inline-block company-logo-wrapper">
              <img [src]="company?.logo || 'assets/logo1.png'" alt="Logo" class="rounded border bg-white company-logo-img" />
              <button type="button" class="btn btn-light p-1 position-absolute bottom-0 end-0 border-0 shadow company-logo-btn"
                (click)="openAvatarDialog()" aria-label="Thay đổi logo">
                <i class="bi bi-camera-fill text-white" aria-hidden="true"></i>
              </button>
            </div>
            <div class="ms-3 flex-grow-1 company-side-meta">
              <h5 class="fw-bold text-primary mb-1 company-side-name">Công ty: {{ companyForm.get('name')?.value || 'Tên công ty' }}</h5>
              <span class="badge bg-success company-side-status">Đang hoạt động</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<app-avatar-editor [data]="company" [visible]="showAvatarEditor" (saved)="onAvatarSaved($event)"
  (closed)="onAvatarDialogClosed()">
</app-avatar-editor>

<app-error-dialog *ngIf="showErrorDialog" [title]="errorTitle" [message]="errorMessage" (cancel)="handleCancelError()">
</app-error-dialog>

<app-notification-dialog *ngIf="showConfirmDialog" [title]="confirmTitle" [message]="confirmMessage"
  (confirm)="handleConfirm()" (cancel)="handleCancel()">
</app-notification-dialog>

<app-loading *ngIf="isLoading"></app-loading>
