<div class="container py-4 company-manager-wrapper">
  <h3 class="mb-4 fw-bold text-primary text-center company-manager-title">Quản lý thành viên công ty</h3>
  <div class="d-flex align-items-center mb-3 gap-3 justify-content-center company-manager-controls">
    <input type="text" class="form-control company-search-input" placeholder="Tìm kiếm theo tên, email..." [(ngModel)]="searchText" aria-label="Tìm kiếm theo tên hoặc email">
    <button class="btn btn-primary company-search-btn" (click)="featchMembers()">Tìm kiếm</button>
    <div class="flex-grow-1 company-controls-spacer"></div>
    <button class="btn btn-primary company-approve-btn" routerLink="/approve-member">
      Duyệt thành viên
    </button>
  </div>
  <div class="table-responsive company-table-wrapper">
    <table class="table table-bordered table-hover align-middle text-center company-table">
      <thead class="table-primary company-table-head">
        <tr class="company-table-head-row">
          <th class="text-center company-th">Họ tên</th>
          <th class="text-center company-th">Email</th>
          <th class="text-center company-th">Vai trò</th>
          <th class="text-center company-th company-th-status">Trạng thái</th>
          <th class="text-center company-th company-th-actions">Thao tác</th>
        </tr>
      </thead>
      <tbody class="company-table-body">
        <tr *ngFor="let member of members" class="company-row" (click)="editMember(member); $event.stopPropagation()">
          <td class="text-center company-td" data-label="Họ tên">{{ member.fullName }}</td>
          <td class="text-center company-td" data-label="Email">{{ member.email }}</td>
          <td class="text-center company-td" data-label="Vai trò">{{ member.position }}</td>
          <td class="text-center company-td company-status-cell" data-label="Trạng thái">
            <span class="status-badge company-status-badge" [ngClass]="{
                        'status-active': member.status === 'APPROVED',
                        'status-closed': member.status === 'INACTIVE',
                      }">
              {{ member.status }}
            </span>
          </td>
          <td class="text-center company-td company-actions-cell" data-label="Thao tác">
            <div class="company-action-buttons">
              <button class="btn btn-sm btn-outline-primary me-1 company-action-btn" (click)="editMember(member); $event.stopPropagation()">Sửa</button>
              <button class="btn btn-sm btn-outline-danger company-action-btn" (click)="removeMember(member.id); $event.stopPropagation()">Xóa</button>
            </div>
          </td>
        </tr>
        <tr *ngIf="members.length === 0" class="company-row-empty">
          <td colspan="5" class="text-center text-muted company-empty-cell">Không có thành viên nào phù hợp.</td>
        </tr>
      </tbody>
    </table>
  </div>
  <div *ngIf="totalPages > 1" class="d-flex justify-content-center align-items-center gap-3 company-pagination">
    <button class="btn btn-outline-primary rounded-circle px-2 company-page-btn prev-btn" [disabled]="currentPage === 0"
      (click)="changePage(currentPage - 1)" aria-label="Trang trước">
      <i class="bi bi-chevron-left"></i>
    </button>
    <span class="fw-bold text-primary company-page-info">
      {{ currentPage + 1 }} <span class="text-muted">/ {{ totalPages }} trang</span>
    </span>
    <button class="btn btn-outline-primary rounded-circle px-2 company-page-btn next-btn" [disabled]="currentPage + 1 >= totalPages"
      (click)="changePage(currentPage + 1)" aria-label="Trang sau">
      <i class="bi bi-chevron-right"></i>
    </button>
  </div>
</div>

<ng-template #editMemberDialog let-member>
  <div class="modal fade show d-block company-edit-modal" tabindex="-1" (click)="closeEditDialog()">
    <div class="modal-dialog company-edit-dialog" (click)="$event.stopPropagation()">
      <div class="modal-content company-edit-content">
        <div class="modal-header company-edit-header">
          <h5 class="modal-title company-edit-title">Sửa thông tin thành viên</h5>
          <button type="button" class="btn-close company-edit-close" (click)="closeEditDialog()" aria-label="Đóng"></button>
        </div>
        <div class="modal-body company-edit-body">

          <div class="mb-3">
            <label class="form-label fw-bold">Họ tên</label>
            <input type="text" class="form-control" [value]="fullName" disabled>
          </div>
          <div class="mb-3">
            <label class="form-label fw-bold">Email</label>
            <input type="email" class="form-control" [value]="email" disabled>
          </div>
          <div class="mb-3">
            <label class="form-label fw-bold">Vai trò</label>
            <input type="text" class="form-control" [(ngModel)]="editMemberData!.position">
          </div>
          <div class="mb-3">
            <label class="form-label fw-bold">Trạng thái</label>
            <select class="form-select" [(ngModel)]="editMemberData!.status">
              <option value="APPROVED">Đang hoạt động</option>
              <option value="INACTIVE">Đã khóa</option>
            </select>
          </div>
        </div>
        <div class="modal-footer company-edit-footer">
          <button class="btn btn-secondary company-edit-cancel" (click)="openConfirm('cancel')">Hủy</button>
          <button class="btn btn-primary company-edit-save" (click)="openConfirm('save')">Lưu</button>
        </div>
      </div>
    </div>
  </div>
</ng-template>

<ng-container *ngIf="showEditDialog">
  <ng-container *ngTemplateOutlet="editMemberDialog; context: { member: editMemberData }"></ng-container>
</ng-container>

<app-notification-dialog *ngIf="showConfirmDialog" [title]="confirmTitle" [message]="confirmMessage"
  (confirm)="handleConfirm()" (cancel)="handleCancel()">
</app-notification-dialog>

<app-error-dialog *ngIf="showErrorDialog" [title]="errorTitle" [message]="errorMessage" (cancel)="handleCancelError()">
</app-error-dialog>

<app-loading *ngIf="isLoading"></app-loading>
