<div class="analytics-page">
  <div class="controls-row">
    <div class="btn-group" role="group" aria-label="Chọn khoảng thời gian">
      <button type="button" class="btn btn-outline-primary" [class.active]="range === '7'" (click)="setRange('7')">7 ngày</button>
      <button type="button" class="btn btn-outline-primary" [class.active]="range === '30'" (click)="setRange('30')">30 ngày</button>
      <button type="button" class="btn btn-outline-primary" [class.active]="range === '90'" (click)="setRange('90')">90 ngày</button>
    </div>
  </div>

  <div class="kpi-row">
    <div class="card kpi-card text-white" style="background-color: #e81416;">
      <div class="kpi-label">Tổng số lượt ứng tuyển</div>
      <div class="kpi-value">{{ totalApplications | number }}</div>
    </div>
    <div class="card kpi-card text-white" style="background-color: #ffa500;">
      <div class="kpi-label">Ứng tuyển mới hôm nay</div>
      <div class="kpi-value">{{ newToday | number }}</div>
    </div>
    <div class="card kpi-card text-white" style="background-color: #79c314;">
      <div class="kpi-label">Tỉ lệ Apply → Response</div>
      <div class="kpi-value">{{ funnelConversion }}%</div>
    </div>
    <div class="card kpi-card text-white" style="background-color: #487de7;">
      <div class="kpi-label">Công ty đăng ký mới hôm nay</div>
      <div class="kpi-value">{{ newCompaniesToday }}</div>
    </div>

    <div class="card kpi-card text-white" style="background-color: #4b369d;">
      <div class="kpi-label">Ứng viên đăng ký mới hôm nay</div>
      <div class="kpi-value">{{ newCandidatesToday }}</div>
    </div>

    <div class="card kpi-card text-white" style="background-color: #70369d;">
      <div class="kpi-label">Số job đang hoạt động</div>
      <div class="kpi-value">{{ activeJobsCount }}</div>
    </div>
  </div>

  <div class="charts-grid">
    <div class="chart-card">
      <div class="card">
        <div class="card-header fw-bold" style="background-color: unset;">Ứng tuyển theo thời gian</div>
        <apx-chart
          [series]="lineChart.series || []"
          [chart]="lineChart.chart || { type: 'line', height: 320, zoom: { enabled: false } }"
          [xaxis]="lineChart.xaxis || { categories: [] }"
          [stroke]="lineChart.stroke || { curve: 'smooth' }"
          [tooltip]="lineChart.tooltip || { enabled: true }">
        </apx-chart>
      </div>
    </div>

    <div class="chart-card">
      <div class="card">
        <div class="card-header fw-bold" style="background-color: unset;">Job mới tạo theo thời gian</div>
        <apx-chart
          [series]="jobsCreatedChart.series || []"
          [chart]="jobsCreatedChart.chart || { type: 'line', height: 320 }"
          [xaxis]="jobsCreatedChart.xaxis || { categories: [] }"
          [stroke]="jobsCreatedChart.stroke || { curve: 'smooth' }"
          [tooltip]="jobsCreatedChart.tooltip || { enabled: true }">
        </apx-chart>
      </div>
    </div>

    <div class="chart-card">
      <div class="card">
        <div class="card-header fw-bold" style="background-color: unset;">Ngành nghề nhiều ứng tuyển</div>
        <apx-chart
          [series]="barChart.series || []"
          [chart]="barChart.chart || { type: 'bar', height: 320 }"
          [xaxis]="barChart.xaxis || { categories: [] }"
          [plotOptions]="barChart.plotOptions"
          [dataLabels]="barChart.dataLabels">
        </apx-chart>
      </div>
    </div>
  </div>

  <div class="lists-grid">
    <div class="list-chart-card">
      <div class="card">
        <div class="card-header fw-bold" style="background-color: unset;">Top job theo số lượng ứng tuyển</div>
        <apx-chart
          [series]="topJobsChart.series || []"
          [chart]="topJobsChart.chart || { type: 'bar', height: 320 }"
          [xaxis]="topJobsChart.xaxis || { categories: [] }"
          [plotOptions]="topJobsChart.plotOptions"
          [dataLabels]="topJobsChart.dataLabels">
        </apx-chart>
      </div>
    </div>

    <div class="list-chart-card">
      <div class="card">
        <div class="card-header fw-bold" style="background-color: unset;">Top Công ty tạo nhiều job nhất</div>
        <apx-chart
          [series]="topCompaniesJobsChart.series || []"
          [chart]="topCompaniesJobsChart.chart || { type: 'bar', height: 320 }"
          [xaxis]="topCompaniesJobsChart.xaxis || { categories: [] }"
          [plotOptions]="topCompaniesJobsChart.plotOptions"
          [dataLabels]="topCompaniesJobsChart.dataLabels">
        </apx-chart>
      </div>
    </div>

    <div class="list-chart-card">
      <div class="card">
        <div class="card-header fw-bold" style="background-color: unset;">Top Công ty có nhiều ứng viên ứng tuyển nhất</div>
        <apx-chart
          [series]="topCompaniesApplicantsChart.series || []"
          [chart]="topCompaniesApplicantsChart.chart || { type: 'bar', height: 320 }"
          [xaxis]="topCompaniesApplicantsChart.xaxis || { categories: [] }"
          [plotOptions]="topCompaniesApplicantsChart.plotOptions"
          [dataLabels]="topCompaniesApplicantsChart.dataLabels">
        </apx-chart>
      </div>
    </div>

    <div class="list-chart-card">
      <div class="card">
        <div class="card-header fw-bold" style="background-color: unset;">Top ứng viên có nhiều lượt ứng tuyển nhất</div>
        <apx-chart
          [series]="topCandidatesChart.series || []"
          [chart]="topCandidatesChart.chart || { type: 'bar', height: 320 }"
          [xaxis]="topCandidatesChart.xaxis || { categories: [] }"
          [plotOptions]="topCandidatesChart.plotOptions"
          [dataLabels]="topCandidatesChart.dataLabels">
        </apx-chart>
      </div>
    </div>
  </div>
</div>

<app-loading *ngIf="isLoading"></app-loading>
