<div class="modal fade login-dialog-modal" id="loginModal" tabindex="-1" aria-labelledby="loginModalLabel" aria-hidden="true">
  <div class="modal-dialog login-dialog-wrapper">
    <div class="modal-content login-dialog-content">
      <div class="modal-header login-dialog-header">
        <ul class="nav nav-tabs w-100 login-dialog-tabs">
          <li class="nav-item">
            <button type="button" class="nav-link fw-bold text-dark login-tab-btn" [class.active]="loginTab === 'login'"
              (click)="showLoginTab()">Đăng Nhập</button>
          </li>
          <li class="nav-item">
            <button type="button" class="nav-link fw-bold text-dark login-tab-btn" [class.active]="loginTab === 'register'"
              (click)="showRegisterTab()">Đăng Ký</button>
          </li>
        </ul>
        <button type="button" class="btn-close login-dialog-close" (click)="closeModalLogin()"></button>
      </div>
      <div class="modal-body login-dialog-body">
        <ng-container *ngIf="loginTab === 'login'">
          <form [formGroup]="loginForm" (ngSubmit)="onLoginSubmit()">
            <div class="mb-3">
              <label class="form-label">Email</label>
              <div class="input-group">
                <span class="input-group-text"><i class="bi bi-envelope"></i></span>
                <input type="email" class="form-control" formControlName="email" placeholder="Nhập email của bạn">
              </div>
            </div>
            <div class="mb-3">
              <label class="form-label">Mật khẩu</label>
              <div class="input-group">
                <span class="input-group-text"><i class="bi bi-shield-lock"></i></span>
                <input type="password" class="form-control" formControlName="password" placeholder="Nhập mật khẩu">
              </div>
            </div>
            <button type="submit" class="btn btn-primary w-100 mb-2 login-submit-btn" [disabled]="loginForm.invalid">Đăng nhập</button>
            <p *ngIf="errorMessage" class="mt-3 text-danger text-center login-error-text">{{ errorMessage }}</p>
            <div class="text-center login-switch-links">
              Bạn chưa có tài khoản? <a href="javascript:void(0)" routerLink="/register">Đăng ký ngay</a> | <a
                href="#">Quên mật khẩu</a>
            </div>
          </form>
        </ng-container>
        <ng-container *ngIf="loginTab === 'register'">
          <ng-container *ngIf="registerStep === 'form'; else verifyBlock">
            <form [formGroup]="registerForm" (ngSubmit)="onRegisterSubmit()">
              <div class="mb-3">
                <label for="fullName" class="form-label">Họ và tên</label>
                <input type="text" id="fullName" class="form-control" formControlName="fullName" required>
                <div *ngIf="registerForm.get('fullName')?.invalid && registerForm.get('fullName')?.touched"
                  class="text-danger">
                  Họ và tên không được để trống
                </div>
              </div>
              <div class="mb-3">
                <label for="email" class="form-label">Email</label>
                <input type="email" id="email" class="form-control" formControlName="email" required>
                <div *ngIf="registerForm.get('email')?.errors?.['required'] && registerForm.get('email')?.touched"
                  class="text-danger">
                  Email không được để trống
                </div>
                <div *ngIf="registerForm.get('email')?.errors?.['email'] && registerForm.get('email')?.touched"
                  class="text-danger">
                  Email không hợp lệ
                </div>
              </div>
              <div class="mb-3">
                <label for="phone" class="form-label">Số điện thoại</label>
                <input type="text" id="phone" class="form-control" formControlName="phone">
              </div>
              <div class="mb-3">
                <label for="dob" class="form-label">Ngày sinh</label>
                <input type="date" max="{{ today | date: 'yyyy-MM-dd' }}" min="1900-01-01" id="dob" class="form-control"
                  formControlName="dob" required>
                <div *ngIf="registerForm.get('dob')?.invalid && registerForm.get('dob')?.touched" class="text-danger">
                  Ngày sinh không được để trống
                </div>
              </div>
              <div class="mb-3">
                <label for="password" class="form-label">Mật khẩu</label>
                <input type="password" id="password" class="form-control" formControlName="password" required>
                <div *ngIf="registerForm.get('password')?.invalid && registerForm.get('password')?.touched"
                  class="text-danger">
                  Mật khẩu không được để trống
                </div>
              </div>
              <div class="mb-3">
                <label for="confirmPassword" class="form-label">Xác nhận mật khẩu</label>
                <input type="password" id="confirmPassword" class="form-control" formControlName="confirmPassword"
                  required>
                <div
                  *ngIf="registerForm.get('confirmPassword')?.invalid && registerForm.get('confirmPassword')?.touched"
                  class="text-danger">
                  Xác nhận mật khẩu không được để trống
                </div>
                <div
                  *ngIf="registerForm.get('confirmPassword')?.value !== registerForm.get('password')?.value && registerForm.get('confirmPassword')?.touched"
                  class="text-danger">
                  Mật khẩu xác nhận không khớp
                </div>
              </div>
              <button type="submit" class="btn btn-primary w-100 mb-2 register-submit-btn" [disabled]="registerForm.invalid">Đăng
                ký</button>
              <div *ngIf="registerErrorMessage" class="alert alert-danger mt-3">{{ registerErrorMessage }}</div>
            </form>
          </ng-container>
          <ng-template #verifyBlock>
            <div class="text-center py-4 verify-block">
              <h5 class="fw-bold text-success mb-3 verify-title">Vui lòng kiểm tra email để xác thực tài khoản!</h5>
              <div class="mb-2 verify-line">Chúng tôi đã gửi một email xác thực tới <b>{{ emailToVerify }}</b>.</div>
              <div class="mb-3 verify-line">Hãy nhập mã xác thực để hoàn tất đăng ký.</div>
              <div class="row justify-content-center align-items-center mb-2 verify-code-row">
                <div class="col-7 verify-code-input-col">
                  <input type="text" class="form-control verify-code-input" placeholder="Nhập mã xác thực" [(ngModel)]="verifyCode">
                </div>
                <div class="col-5 verify-otp-btn-col">
                  <button class="btn btn-outline-primary w-100 resend-otp-btn" [disabled]="otpCountdown > 0" (click)="resendOtp()">
                    Gửi lại mã OTP
                    <span *ngIf="otpCountdown > 0">({{ otpCountdown }}s)</span>
                  </button>
                </div>
              </div>
              <button class="btn btn-success w-100 mb-2 verify-submit-btn" (click)="onVerifyEmail()">Xác thực</button>
              <div class="mt-3 verify-back-link">
                <a href="javascript:void(0)" (click)="registerStep = 'form'">Quay lại đăng ký</a>
              </div>
            </div>
            <div *ngIf="verifyErrorMessage" class="alert alert-info mt-3 verify-error-text">{{ verifyErrorMessage }}</div>
          </ng-template>
        </ng-container>
      </div>
    </div>
  </div>
</div>
